Copy of some code from TestFX/MSTest V2.

See:

https://github.com/microsoft/testfx/tree/664ac7c2ac9dbfbee9d2a0ef560cfd72449dfe34/src/TestFramework/Extension.Desktop
https://github.com/microsoft/testfx/issues/366#issuecomment-580147403